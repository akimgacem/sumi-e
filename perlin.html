<!doctype html>
<html>
  <head>
  </head>

  <body>
    <canvas id="noise" width="512" height="512">
    </canvas>

    <script>
      var canvas = document.getElementById("noise"),
          ctx = canvas.getContext("2d"),
          id = ctx.getImageData(0, 0, 512, 512),
          noise = [
            120, 178,  54, 168, 102, 218, 142, 174,
            239, 200, 143,  97,  85, 135, 187, 199,
            115, 205, 146, 126, 251, 204, 181, 112,
            240,  45, 117, 154,  27,  97, 129, 255,
            147,  91, 152,  16, 196, 160,  57, 110,
             43, 231, 111,  69,  12, 125,   6,  15,
            180,  40,  18, 187, 124,  42, 101, 221,
             31, 122, 147, 162, 233, 103,  51, 184,

            148,   5,  43,  19, 199, 208, 238, 148,
            191, 243,  47, 166, 132,  95, 134, 156,
            237, 235, 167,  19, 208,  33, 205, 220,
             43, 159, 161,  96,  73, 199, 173, 182,
            161, 170,  70,  45,  29,  48,   2, 187,
            242,  23,  30, 199, 145,   8, 137,   6,
             47, 208,  81, 178, 245,  44, 139, 253,
            204, 188,  99, 189, 225, 147,  11, 152,

            122, 212, 162,  44,  86, 249, 148,  79,
            223, 131,  73,  30,  47, 160,  13, 211,
            176, 158,  31,  90, 185,  47, 183, 155,
            125,  69, 127, 162, 239,  24, 223, 157,
            109,  88, 158,  80, 204, 245, 196, 165,
            134,   4,  28,  67, 233, 197,  64,   6,
            127, 230,  49,  45,  31, 132, 235,  39,
            238, 147,  53, 228, 152, 136, 182,  68,

            211,  24,   3, 231, 189,  10, 168, 229,
            135,  70, 140,  19,  48,  96, 189,  40,
             53, 159, 159,  45, 235, 234,  74, 155,
            178, 173,  63,  70, 211, 215,  60, 100,
            133, 196, 103,  39,  85, 142, 208,  60,
            172,  47, 156,  11, 238,   6, 146, 190,
            124, 229, 249, 195, 217,  57,  80, 190,
             76,  77, 185, 176,  22,   7,  96, 209,

            194,  76, 207,  68,  51, 109, 189, 251,
             14, 110, 190, 224, 176, 132, 173, 129,
            175,  35,  46,  61, 179,  95, 167, 137,
            178,   4,  59, 250, 181,  47,  54,  88,
            107,  15, 127,  95,  11,  18,   0,  78,
            131, 215, 149, 254,   7, 203, 191, 198,
            114, 177,   9, 126,  39, 195, 152, 138,
            161,  91, 244, 143, 171, 124,  44,  19,

             43,  95, 216,  27,  47, 222, 124,  40,
            134, 174, 181,  66,  80, 130,  70,   1,
             15,  44, 129,  14,  57, 210, 106,  74,
             92,  83, 112, 139, 144,   0, 169, 223,
             91,  82,  60,  60,  69, 174, 251, 187,
            180, 206, 162, 217, 253, 124, 135,   3,
             31, 167,   0,  38,  65, 222, 252,  12,
              2,  49, 145, 215,  19, 195,  69,  22,

              2, 121,  42,  29,  24, 211, 127, 169,
             45, 244, 157,  20,  33, 183, 230,  57,
             26, 104, 108,  78, 149, 177, 147,  39,
             10,  38, 108, 252, 242, 234,  72, 192,
              7, 235,  76, 234, 180, 235,  16,  21,
            220, 199, 243, 206,  84,  64, 146, 211,
             87, 194, 253,  70, 112, 181, 211,  21,
             46, 160, 196, 203,  35,  51, 170, 232,

             68, 251,  81, 243, 101, 200,  47, 242,
            254, 233,  60, 163, 183, 236, 232,  76,
             69,  83,  70, 131, 154,  99, 150, 125,
             68,  62,   3, 112, 214,  80,  62, 217,
             26, 251,  77,  92,  84, 176, 237, 115,
            232,   2, 255, 174, 140,  45, 124, 137,
            223, 181,  65, 181,  91, 157,  21, 220,
             29, 181, 148, 167,  58, 174, 226,  79
          ],
          x, y, z

      function lerp(a, b, x) {
        return a + (b - a) * x
      }

      function lookup(x, y, z) {
        var i = Math.floor(x),
            j = Math.floor(y),
            k = Math.floor(z)

        x -= i
        y -= j
        z -= k

        x = x * x * x * (x * (x * 6 - 15) + 10)
        y = y * y * y * (y * (y * 6 - 15) + 10)
        z = z * z * z * (z * (z * 6 - 15) + 10)

        return lerp(
          lerp(
            lerp(
              noise[((k & 7) * 8 + (j & 7)) * 8 + ( i      & 7)],
              noise[((k & 7) * 8 + (j & 7)) * 8 + ((i + 1) & 7)],
              x
            ),
            lerp(
              noise[((k & 7) * 8 + ((j + 1)  & 7)) * 8 + ( i      & 7)],
              noise[((k & 7) * 8 + ((j + 1) & 7)) * 8 + ((i + 1) & 7)],
              x
            ),
            y
          ),
          lerp(
            lerp(
              noise[(((k + 1) & 7) * 8 + (j & 7)) * 8 + ( i      & 7)],
              noise[(((k + 1) & 7) * 8 + (j & 7)) * 8 + ((i + 1) & 7)],
              x
            ),
            lerp(
              noise[(((k + 1) & 7) * 8 + ((j + 1) & 7)) * 8 + ( i      & 7)],
              noise[(((k + 1) & 7) * 8 + ((j + 1) & 7)) * 8 + ((i + 1) & 7)],
              x
            ),
            y
          ),
          z
        )
      }

      function fractal(x, y, z) {
        return (
          lookup(x        , y        , z        ) * 0.10557280900008412 +
          lookup(x * 0.500, y * 0.500, z * 0.500) * 0.17082039324993692 +
          lookup(x * 0.250, y * 0.250, z * 0.250) * 0.27639320225002100 +
          lookup(x * 0.125, y * 0.125, z * 0.125) * 0.44721359549995790
        )
      }

      for(z = 64; z--; ) {
        for(y = 64; y--; ) {
          for(x = 64; x--; ) {
            id.data[((z * 64 + y) * 64 + x) * 4 + 0] =
            id.data[((z * 64 + y) * 64 + x) * 4 + 1] =
            id.data[((z * 64 + y) * 64 + x) * 4 + 2] = Math.round(fractal(x, y, z))
            id.data[((z * 64 + y) * 64 + x) * 4 + 3] = 255
          }
        }
      }

      ctx.putImageData(id, 0, 0)
    </script>

    <img src="fbm.png">
  </body>
</html>
